"============================================================================
" Vundle packages 
"============================================================================

filetype off
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
" alternatively, pass a path where Vundle should install plugins
"call vundle#begin('~/some/path/here')

" let Vundle manage Vundle, required
Plugin 'VundleVim/Vundle.vim'

Plugin 'junegunn/fzf'
Plugin 'junegunn/fzf.vim'

Plugin 'https://tpope.io/vim/fugitive.git'

Plugin 'vim-airline/vim-airline'
Plugin 'dikiaap/minimalist'

Plugin 'majutsushi/tagbar'
Plugin 'scrooloose/nerdtree'

Plugin 'valloric/youcompleteme'
Plugin 'SirVer/ultisnips'
Plugin 'honza/vim-snippets'
Plugin 'ervandew/supertab'

Plugin 'chazy/cscope_maps'
Plugin 'taglist.vim'
"Plugin 'ludovicchabant/vim-gutentags'

Plugin 'scrooloose/nerdcommenter'

"Javascript
Plugin 'mxw/vim-jsx'
Plugin 'dense-analysis/ale'
Plugin 'prettier/vim-prettier'
Plugin 'neoclide/coc.nvim'
Plugin 'neoclide/coc-tsserver'
Plugin 'pangloss/vim-javascript'
Plugin 'maxmellon/vim-jsx-pretty'
Plugin 'leafgarland/typescript-vim'
Plugin 'peitalin/vim-jsx-typescript'
Plugin 'ludovicchabant/vim-gutentags'

" All of your Plugins must be added before the following line
call vundle#end()            " required
filetype plugin indent on    " required
" To ignore plugin indent changes, instead use:
"filetype plugin on
"
" Brief help
" :PluginList       - lists configured plugins
" :PluginInstall    - installs plugins; append `!` to update or just :PluginUpdate
" :PluginSearch foo - searches for foo; append `!` to refresh local cache
" :PluginClean      - confirms removal of unused plugins; append `!` to auto-approve removal
"
" see :h vundle for more details or wiki for FAQ
" Put your non-Plugin stuff after this line





"============================================================================
" Javascript,Typescript,Python,etc.
"============================================================================

"https://thoughtbot.com/blog/modern-typescript-and-react-development-in-vim#highlighting-for-large-files

autocmd BufEnter *.{js,jsx,ts,tsx} :syntax sync fromstart
autocmd BufLeave *.{js,jsx,ts,tsx} :syntax sync clear

autocmd FileType javascript      setlocal shiftwidth=2 tabstop=2 expandtab
autocmd FileType typescriptreact setlocal shiftwidth=2 tabstop=2 expandtab
autocmd FileType html            setlocal shiftwidth=2 tabstop=2 expandtab
autocmd FileType python          setlocal shiftwidth=4 softtabstop=4 expandtab

let g:ale_fixers = {'javascript': ['eslint'], 'typescript': ['tslint'],'typescriptreact': ['prettier', 'eslint'], 'python': ['autopep8', 'yapf'], 'json': ['fixjson']}
let g:ale_linters_explicit = 1
let g:ale_fix_on_save = 1
let g:ale_javascript_prettier_options = '--single-quote --trailing-comma all'

let g:jsx_ext_required = 1 





"============================================================================
" Basic options
"============================================================================

set number                  "nu : show line
set smartcase
set ruler                   "ru : inform cursor position in right below side
set nowrapscan
set background=dark
set ignorecase              "dont distinguish capital and little during searching
set hlsearch                "highlight to searched string"
set showmatch               "show coupled pharenthisis
set magic                   "use special character in searching pattern
set title
set nobackup                "dont make backup file
set noswapfile              "dont make backup file
"set backupdir=~/.vim/temp/backup
"set directory=~/.vim/temp/swap
set cursorline              "show curson location at the time
set sc                      "show command under the window
set fdm=manual              "code editing way : manual, indent, expr, marker, syntax, diff
set fencs=utf-8,euc-kr,cp949,cp932,euc-jp,shift-jis,big5,latin1,ucs-2le
set enc=utf-8
set tenc=utf-8
set encoding=utf-8
set nocul                   "highlighting word on cursor
set fileformat=unix
set mouse=a
set backspace=indent,eol,start whichwrap+=<,>,[,]
set belloff=all
"set km=startsel,stopesel    "use shift to select blocks
let mapleader = ";"
set nopaste
"set paste
"set guioptions=gmrL        "eliminate tool box
"set guifont=Dina:h9:cANSI
"set comments=sl:/*,mb:*,elx:*/
"set loadplugins
"set mousemodel=popup
"set visualbell             "vb : there will be visual effect rather than beeping when you input wrong key
"set comments=sl:/*,mb:*,elx:*/
"set loadplugins
"set fillchars+=stl:\ ,stlnc:\
set helplang=ko





"============================================================================
" Color
"============================================================================

"colorscheme minimalist
set t_Co=256
syntax on

"hi ModeMsg ctermfg=2 ctermbg=0
"hi Todo ctermfg=4 ctermbg=0
"hi Include ctermfg=4 ctermbg=0
"hi PreProc ctermfg=4 ctermbg=0
"hi Comment ctermfg=4 ctermbg=0
"hi Normal ctermfg=6 ctermbg=0
"hi Type ctermfg=6 ctermbg=0
"hi Function ctermfg=3 ctermbg=0
"hi Special ctermfg=3 ctermbg=0
"hi Statement ctermfg=6 ctermbg=0
"hi Pmenu ctermbg=1
"hi Title ctermfg=4 ctermbg=0
"hi treePart ctermfg=2 ctermbg=0
"hi treeDir ctermfg=2 ctermbg=0
"hi treeFile ctermfg=4 ctermbg=0
"hi Search term=reverse ctermfg=9 ctermbg=1

"xming setting
"colorscheme jellybeans
"syntax on
"hi ModeMsg ctermfg=2 ctermbg=0





"============================================================================
" plugins setup 
"============================================================================
" Trigger configuration. You need to change this to something other than <tab>
" if you use one of the following:
" - https://github.com/Valloric/YouCompleteMe
" - https://github.com/nvim-lua/completion-nvim

" make YCM compatible with UltiSnips (using supertab)
let g:ycm_key_list_select_completion = ['<C-n>', '<Down>']
let g:ycm_key_list_previous_completion = ['<C-p>', '<Up>']
let g:ycm_show_diagnostics_ui = 1
let g:ycm_add_preview_to_completeopt = 1
let g:ycm_autoclose_preview_window_after_insertion = 1
let g:ycm_autoclose_preview_window_after_completion = 1
let g:ycm_always_populate_location_list = 1
"set splitbelow

let g:SuperTabDefaultCompletionType = '<C-n>'

" better key bindings for UltiSnipsExpandTrigger
let g:UltiSnipsExpandTrigger = "<tab>"
let g:UltiSnipsJumpForwardTrigger = "<tab>"
let g:UltiSnipsJumpBackwardTrigger = "<s-tab>"

" If you want :UltiSnipsEdit to split your window.
let g:UltiSnipsEditSplit="vertical"

let NERDTreeWinPos = "right"
let g:tagbar_left = 1





"============================================================================
" Toggle Key options
"============================================================================

"call feedkeys(":TagbarToggle\<cr>", 'n')
"
"nmap <F2> :bp<cr>
"nmap <F3> :bn<cr>
nmap <F2> <C-W>p
nmap <F3> <C-W>b
nmap <F4> :w!<cr>
nmap <F5> :A<cr>
nmap <F6> :marks<cr>
nmap <F7> <Leader>bv
nmap <F8> z.:TlistSync<cr>
"nmap <F9> :mkview<cr>:qa!<cr>
nmap <F9> :NERDTreeToggle<cr>:TagbarToggle<cr>
nmap <F11> :mkview<cr>:qa<cr>
nmap <F12> :%s/from/to/gc

nmap <PageUp> :bp<cr>
nmap <PageDown> :bn<cr>

noremap <C-A> gg<S-V>G
inoremap <C-A> <C-O>gg<C-O><S-V>G

map <leader>sp :sp<cr>
map <leader>vs :vs<cr>

"using tab
map <leader>tt :tabnew<cr>
map <leader>tn :tabnext<cr>
map <leader>tp :tabprevious<cr>
map <leader>tc :tabclose<cr>

"using vimgrep
"map <leader>gl :cc<cr>
map <leader>gl :clist<cr>
map <leader>gr :crewind<cr>
"map <leader>gr :clast<cr>
map <leader>gn :cnext<cr>
map <leader>gp :cprevious<cr>

"using quickfix
"map <leader>ll :ll<cr>
map <leader>ll :llist<cr>
map <leader>lr :lrewind<cr>
"map <leader>lr :llast<cr>
map <leader>ln :lnext<cr>
map <leader>lp :lprevious<cr>

nmap <C-H> <C-W>h
nmap <C-J> <C-W>j
nmap <C-K> <C-W>k
nmap <C-L> <C-W>l

"make src.i before using below
"nmap <C-I> :vs<cr> echon system('grep -A2 -B2 "$(sed -n '.line(".").'p '.expand("%:p").'\|sed -e "s/^[ \t]\+//;s/\([]\*\.[]\)/\\\\\1/g;s/\(__\)\?[a-z][a-z_0-9]*(\(([u2346])\)\?[^)]*)/.*/g;s/__[a-z]\+/.*/g;s/[A-Z][A-Z_0-9]*/.*/g")" '.expand("%:p:r").'.i')<CR>
"nmap <C-O> :vs<cr> echon system('grep -A2 -B2 "$(sed -n '.line(".").'p '.expand("%:p").'\|sed -e "s/^[ \t]\+//;s/\([]\*\.[]\)/\\\\\1/g;s/[A-Z][A-Z_0-9]*/.*/g")" '.expand("%:p:r").'.i')<CR>

vnoremap <BS> d
vmap <Tab> >gv
vmap <S-Tab> <gv

cnoremap <C-A> <Home>      "start of line
cnoremap <C-B> <Left>      "back one character
cnoremap <C-D> <Del>       "delete character under cursor
cnoremap <C-E> <End>       "end of line
cnoremap <C-F> <Right>     "forward one character
cnoremap <C-N>		<Down>      "recall newer command-line
cnoremap <C-P>		<Up>        "recall previous (older) command-line
cnoremap <Esc><C-B>	<S-Left>  "back one word
cnoremap <Esc><C-F>	<S-Right> "forward one word


"" for terminal mode
tnoremap <ESC><ESC> <C-\><C-N>
tnoremap <C-H> <C-W>h
tnoremap <C-J> <C-W>j
tnoremap <C-K> <C-W>k
tnoremap <C-L> <C-W>l

"" for fuf
map <leader>ff :Files<cr>
map <leader>fb :Buffers<cr>
map <leader>fg :Rg<cr>
map <leader>fc :Commits<cr>
map <leader>fh :History<cr>
"map <leader>fs :Snippets<cr>





"============================================================================
" coding
"============================================================================

let g:tagbar_left = 1
let NERDTreeWinPos = "right"

"" for hexa
":%!xxd : show as hex
":%!xxd -r : show as text





"============================================================================
" ctags, cscope initialization
"============================================================================

set tags+=./tags;
set tags+=/home/hyukmyeong/.vim/tags/cpp_tags;
"set isk+=:
"
let &path = getcwd() . '/**'

set path+=/usr/include,/usr/include/c++/9;
set path+=/usr/local/include;

"au BufWritePost *.c,*.cc,*.cpp,*.h,*.hh silent! execute "!ctags -R --c++-kinds=+p --fields=+ailmnS --extra=+q --exclude={.git,oe-workdir,oe-logs} >/dev/null 2>&1 &"

"au FileType {h,c,cpp} au BufWritePost <buffer> silent ! [ -e tags ] &&
    "\ ( awk -F'\t' '$2\!="%:gs/'/'\''/"{print}' tags ; ctags -f- '%:gs/'/'\''/' )
    "\ | sort -t$'\t' -k1,1 -o tags.new && mv tags.new tags


let g:gutentags_add_default_project_roots = 0
let g:gutentags_project_root = ['package.json', '.git', '.projectile']
let g:gutentags_cache_dir = expand('~/.cache/vim/ctags/')
command! -nargs=0 GutentagsClearCache call system('rm ' . g:gutentags_cache_dir . '/*')

let g:gutentags_generate_on_new = 1
let g:gutentags_generate_on_missing = 1
let g:gutentags_generate_on_write = 1
let g:gutentags_generate_on_empty_buffer = 0

let g:gutentags_ctags_exclude = [
      \ '*.git', '*.svg', '*.hg',
      \ '*/tests/*',
      \ 'build',
      \ 'dist',
      \ '*sites/*/files/*',
      \ 'bin',
      \ 'node_modules',
      \ 'bower_components',
      \ 'cache',
      \ 'compiled',
      \ 'docs',
      \ 'example',
      \ 'bundle',
      \ 'vendor',
      \ '*.md',
      \ '*-lock.json',
      \ '*.lock',
      \ '*bundle*.js',
      \ '*build*.js',
      \ '.*rc*',
      \ '*.json',
      \ '*.min.*',
      \ '*.map',
      \ '*.bak',
      \ '*.zip',
      \ '*.pyc',
      \ '*.class',
      \ '*.sln',
      \ '*.Master',
      \ '*.csproj',
      \ '*.tmp',
      \ '*.csproj.user',
      \ '*.cache',
      \ '*.pdb',
      \ 'tags*',
      \ 'cscope.*',
      \ '*.css',
      \ '*.less',
      \ '*.scss',
      \ '*.exe', '*.dll',
      \ '*.mp3', '*.ogg', '*.flac',
      \ '*.swp', '*.swo',
      \ '*.bmp', '*.gif', '*.ico', '*.jpg', '*.png',
      \ '*.rar', '*.zip', '*.tar', '*.tar.gz', '*.tar.xz', '*.tar.bz2',
      \ '*.pdf', '*.doc', '*.docx', '*.ppt', '*.pptx',
      \ ]

"cscope reset
"cscope show
"cscope kill
"cscope add


if has("cscope")
       set csprg=/usr/bin/cscope
       set csto=0
       set cst
       set nocsverb
       set cscopetag

       if filereadable("./cscope.out")
         cs add ./cscope.out . -C
       elseif filereadable("../cscope.out")
         cs add ../cscope.out . -C
       elseif filereadable("../../cscope.out")
         cs add ../../cscope.out . -C
       elseif filereadable("../../../cscope.out")
         cs add ../../../cscope.out . -C
       elseif filereadable("../../../../cscope.out")
         cs add ../../../../cscope.out . -C
       elseif filereadable("../../../../../cscope.out")
         cs add ../../../../../cscope.out . -C
       elseif filereadable("../../../../../../cscope.out")
         cs add ../../../../../../cscope.out . -C
       else
         cs add /usr/src/linux/cscope.out
       endif

"       if $CSCOPE_DB != ""
"              cs add $CSCOPE_DB
"       endif

       if version >= 500
         func! Sts()
           let st = expand("<cword>")
           exe "sts ".st
         endfunc
         nmap ;st :call Sts()<cr>

         func! Tj()
           let tj = expand("<cword>")
           exe "tj ".tj
         endfunc
         nmap ;tj :call Tj()<cr>
       endif

       func! Css()
         let css = expand("<cword>")
"         new
         exe "cs find s .*".css

         if getline(1) == ""
           exe "q!"
         endif
       endfunc
       nmap ;css :call Css()<cr>

       func! Csc()
         let csc = expand("<cword>")
"         new
         exe "cs find c .*".csc

         if getline(1) == ""
           exe "q!"
         endif
       endfunc
       nmap ;csc :call Csc()<cr>

       func! Csd()
         let csd = expand("<cword>")
"         new
         exe "cs find d .*".csd

         if getline(1) == ""
           exe "q!"
         endif
       endfunc
       nmap ;csd :call Csd()<cr>

       func! Csg()
         let csg = expand("<cword>")
"         new
         exe "cs find g .*".csg

         if getline(1) == ""
           exe "q!"
         endif
       endfunc
       nmap ;csg :call Csg()<cr>
endif





"============================================================================
" Functions
"============================================================================

let s:paren_hl_on = 0
function s:Highlight_Matching_Paren()
	if s:paren_hl_on
		match none
		let s:paren_hl_on = 0
	endif

	let c_lnum = line('.')
	let c_col = col('.')

	let c = getline(c_lnum)[c_col - 1]
	let plist = split(&matchpairs, ':\|,')
	let i = index(plist, c)
	if i < 0
		return
	endif
	if i % 2 == 0
		let s_flags = 'nW'
		let c2 = plist[i + 1]
	else
		let s_flags = 'nbW'
		let c2 = c
		let c = plist[i - 1]
	endif
	if c == '['
		let c = '\['
		let c2 = '\]'
	endif
	let s_skip ='synIDattr(synID(line("."), col("."), 0), "name") ' .
	\ '=~?	"string\\|comment"'
	execute 'if' s_skip '| let s_skip = 0 | endif'

	let [m_lnum, m_col] = searchpairpos(c, '', c2, s_flags, s_skip)

	if m_lnum > 0 && m_lnum >= line('w0') && m_lnum <= line('w$')
		exe 'match Search /\(\%' . c_lnum . 'l\%' . c_col .
		\ 'c\)\|\(\%' . m_lnum . 'l\%' . m_col . 'c\)/'
		let s:paren_hl_on = 1
	endif
endfunction

autocmd CursorMoved,CursorMovedI * call s:Highlight_Matching_Paren()
autocmd InsertEnter * match none





"============================================================================
" Deprecated 
"============================================================================

"" removes trailing spaces
"function! TrimWhiteSpace()
"	    %s/\s\+$//e
"endfunction

"autocmd FileWritePre    * :call TrimWhiteSpace()
"autocmd FileAppendPre   * :call TrimWhiteSpace()
"autocmd FilterWritePre  * :call TrimWhiteSpace()
"autocmd BufWritePre     * :call TrimWhiteSpace()

"" tetris 
"source ~/.vim/plugin/tetris.vim
